# CI Agent

Competitive Intelligence Agent using the OpenAI Agents SDK, a Meta Language for CI tasks, Streamlit UI, uv for dependency management, ruff for linting, and Podman for containerized deployment. This repository also includes a GitHub Actions workflow for CI and image publishing.

## Features

1. OpenAI Agents SDK based agent encapsulating a competitive intelligence meta-language.
2. Streamlit graphical interface to invoke agent commands.
3. uv for fast, reproducible dependency resolution and virtual environments.
4. ruff for lint and format checks in local and CI workflows.
5. Dockerfile with multi-stage build and non-root runtime (compatible with Podman).
6. GitHub Actions workflow for linting, testing, caching, and image publishing to GHCR.

## Repository Structure

```
ci-agent/
  pyproject.toml
  uv.lock                 # optional; generated by uv and committed for deterministic builds
  .ruff.toml
  .containerignore
  Dockerfile
  Makefile
  README.md
  src/
    ci_agent/
      __init__.py
      agent.py
      cli.py
      streamlit_app.py
  tests/
    test_ci_agent.py
  .github/
    workflows/
      ci.yml
```

## Prerequisites

- Python 3.11 or later
- uv installed locally
- Podman (optional for container build)
- An OpenAI-compatible API key if your Agents SDK requires it
- GitHub account and repository if you intend to use GHCR publishing

## Quickstart (Local)

1. Create environment and sync dependencies.

```bash
make setup
```

2. Lint and test.

```bash
make lint
make test
```

3. Run the Streamlit UI.

```bash
make run
# Open http://localhost:8501
```

## Command-line Usage

The CLI wraps the agent and builds a meta-language call based on arguments.

```bash
python -m ci_agent.cli --cmd CI_landscape --entities "Company A" "Company B" "Company C" --format markdown --urls https://example1.com https://example2.com https://example3.com
```

Examples:

```bash
python -m ci_agent.cli --cmd CI_compare --entities "Company A" "Company B" --format markdown --urls https://example1.com https://example2.com
python -m ci_agent.cli --cmd CI_matrix --entities "Company A" "Company B" "Company C" --criteria "Evaluation speed" "ATO readiness" "Integration effort" "TCO 3yr"
python -m ci_agent.cli --cmd CI_signals --topic "AI-enabled knowledge management in U.S. federal market"
python -m ci_agent.cli --cmd CI_playbook --entity "Company A" --urls https://example1.com
```

## Streamlit UI

Run locally:

```bash
make run
```

In the UI, select a command, provide entities or topic, choose output format, and run. JSON output will render as structured JSON when valid. Markdown is the default.

## Podman

Build the image:

```bash
make podman-build
```

Run the container:

```bash
export OPENAI_API_KEY=YOUR_KEY
make podman-run
# Open http://localhost:8501
```

## GitHub Actions CI

The workflow `.github/workflows/ci.yml`:

1. Installs uv and syncs dependencies.
2. Runs ruff lint and format checks.
3. Runs pytest.
4. Builds and pushes a container image to GHCR for pushes to main or version tags (v*).

To enable GHCR pushes, ensure `packages: write` permission is available for the workflow and your repository is public or you have access rights.

## OpenAI Agents SDK Integration

The agent is defined in `src/ci_agent/agent.py` with:

- A meta-language instruction block that maps CI_* calls to structured outputs.
- Optional function tools using `@function_tool` for schema-validated actions.
- An input guardrail that classifies whether a request is competitive-intelligence related.
- Execution via `Runner.run(ci_agent, user_input)`.

## Development Notes

- uv manages a local virtual environment at `.venv` when `UV_PROJECT_ENVIRONMENT=.venv` is set.
- ruff is configured via `.ruff.toml` or pyproject section. Use `make lint` to verify before commits.
- Commit `uv.lock` for reproducible CI builds.

## Troubleshooting

- If `uv sync` fails inside container builds due to network constraints, try building again or ensure no corporate proxy blocks downloads.
- If the Agents SDK import path differs, update the `openai-agents` dependency and `from agents import ...` import statements.
- For JSON output, ensure the requested `format` is `json` and that your model instructions return valid JSON.

## License

MIT License. Replace with your preferred license.
